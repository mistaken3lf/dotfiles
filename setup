#!/usr/bin/env bash

# Setup Yay
sudo pacman -S --needed git base-devel && git clone https://aur.archlinux.org/yay.git && cd yay && makepkg -si

# Go back and delete the created yay directory
cd ..
rm -rf yay

# Update packages
yay -Syyu

# Install packages from pkglist
yay -S --needed - < pkglist.txt

# Create file for nvidia used by hyprland
sudo touch /etc/modprobe.d/nvidia.conf
echo 'options nvidia-drm modeset=1' | sudo tee /etc/modprobe.d/nvidia.conf

# Enables services
sudo systemctl enable tlp.service
sudo systemctl enable sddm.service
sudo systemctl enable bluetooth.service

# Add user to groups
sudo usermod -aG wheel $(whoami)
sudo usermod -aG video $(whoami)

# Copy config files
cp -r ./foot ~/.config
cp -r ./hypr ~/.config
cp -r ./mako ~/.config
cp -r ./waybar ~/.config
cp -r ./wlogout ~/.config
cp -r ./wofi ~/.config

# Copy bash config
cp ./.bashrc ~/
source ~/.bashrc

# Create hyprland desktop entry
sudo cp ./hyprland.desktop /usr/share/wayland-sessions

# Copy sddm config file
sudo cp ./sddm.conf /etc

# Enable color and multilib
sed -i '/Color/s/^#//' /etc/pacman.conf
sed -i '/Color/a ILoveCandy' /etc/pacman.conf
sed -i "/\[multilib\]/,/Include/"'s/^#//' /etc/pacman.conf

# Update packages
yay -Syyu